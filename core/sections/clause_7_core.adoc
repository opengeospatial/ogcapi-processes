
== Requirements Class "Core"

The following section describes the Core requirements class.


=== Overview

include::../requirements/requirements_class_core.adoc[]

A server that implements the OGC API - Processes Standard provides access to processes.

Each implementation of the OGC API - Processes Standard has a single `LandingPage` (path `/`) that provides links to:

* The `APIDefinition` (no fixed path),
* The `Conformance` statements (path `/conformance`),
* The `processes` metadata (path `/processes`).

Note that additional requirements classes may introduce additional links for inclusion in the landing page.

The `APIDefinition` describes the capabilities of the server that can be used by clients to connect to the server or by development tools to support the implementation of servers and clients. Accessing the `APIDefinition` using HTTP GET returns a description of the an API that includes the Processes API defined in this Standard but may include the description of additional components that are part of a broader containing API.

Accessing `Conformance` using HTTP GET returns a list of URIs of conformance classes implemented by the server.

The list of processes contains a summary of each process offered by the OGC API - Processes implementation, including the link to a more detailed description of the process.

The <<sc_process_description,process description>> contains information about inputs and outputs and a link to the execution-endpoint for the process.

A HTTP POST request to the execution-endpoint creates a new job. The inputs and outputs need to be passed in a JSON execute-request.

The URL for accessing status information is delivered in the HTTP header `location`.

After a process is finished (status = success/failed), the results/exceptions can be retrieved.

[[img_core]]
.Resources in the Core requirements class
image::core/figures/PT1_FIG01.png[align="center"]

The OGC API - Processes Standard utilizes elements of the OGC API-Common Standard. <<mapping-to-common>> Identifies the API-Common Requirements Classes which are applicable to each section of this Processes API Standard.

[[mapping-to-common]]
.Mapping API - Processes Sections to API-Common Requirements Classes
[cols="2,6"]
|===
^|*API - Processes Section* ^|*API-Common Requirements Class*
|<<sc_landing_page,API Landing Page>>| http://www.opengis.net/spec/ogcapi-common-1/1.0/req/core
|<<sc_api_definition,API Definition>>| http://www.opengis.net/spec/ogcapi-common-1/1.0/req/core
|<<sc_conformance_classes,Declaration of Conformance Classes>>| http://www.opengis.net/spec/ogcapi-common-1/1.0/req/core
|<<requirements-class-openapi_3_0-clause,OpenAPI 3.0>>| http://www.opengis.net/spec/ogcapi-common-1/1.0/req/oas30
|<<sc_requirements_class_html,HTML>>| http://www.opengis.net/spec/ogcapi-common-1/1.0/req/html
|===


[[sc_landing_page]]
=== Retrieve the API landing page

The following section defines the requirements to retrieve an API landing page that contains links to Processes API resources but may also contain links to resources that are part of a broader, containing, API.  

==== Operation

include::../requirements/core/REQ_landingpage-op.adoc[]


==== Response

include::../requirements/core/REQ_landingpage-success.adoc[]

[NOTE]
====
The term “_...based upon the OpenAPI 3.0 schema..._” used in the requirements of this Standard means that OpenAPI 3.0 is used to define:

* All the required properties of the respective request/response schema,
* Any optional properties of the respective request/response schema.

It also means that unless explicitly excluded these OpenAPI schemas are extensible with additional properties not defined in the schema using the https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.0.md#schemaObject[`additionalProperties`] mechanism defined in the https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.0.md[OpenAPI 3.0 specification].
====

.Schema for the landing page
[source,yaml]
----
include::../../openapi/schemas/common-core/landingPage.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/common-core/landingPage.yaml[`landingPage.yaml`].


[[link-schema]]
.Schema for a link
[source,yaml]
----
include::../../openapi/schemas/common-core/link.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/common-core/link.yaml[`link.yaml`].

.Landing page response document
====
[source,json]
----
include::../examples/json/LandingPage.json[]
----
====

==== Error situations

See <<http_status_codes>> for general guidance.


[[sc_api_definition]]
=== Retrieve an API definition

The following section defines the requirements to retrieve an API definition.  This API may only implement components of the Processes API defined in this Standard but may define the implementation of a broader API into which the Processes API is embedded.

==== Operation

Every implementation of OGC API - Processes must provide metadata that describe the functional capabilities of the server instance that the API definition provides access to.  In this document, this is known as the "API definition".  This definition is used by developers to understand the functionality provided by the API endpoing, so software clients can connect to the server, or by development tools to support the implementation of servers and clients.

include::../requirements/core/REQ_api-definition-op.adoc[]

include::../recommendations/core/PER_api-definition-uri.adoc[]

Note that multiple API definition formats can be supported.


==== Response

include::../requirements/core/REQ_api-definition-success.adoc[]

include::../recommendations/core/REC_api-definition-oas.adoc[]

If multiple API definition formats are supported by a server, use
content negotiation to select the desired representation.

[NOTE]
====
Two common approaches are:

* An additional path for each encoding of each resource (this can be expressed,
for example, using format specific suffixes like ".html");

* An additional query parameter (for example, "accept" or "f") that overrides
the Accept header of the HTTP request.
====

The API definition document describes the API. In other words, there is no need to include the `/api` operation in the API definition itself.

The idea is that any implementation of OGC API - Processes can be used by developers that are familiar with the API definition language(s) supported by the server. For example, if an OpenAPI definition is used, it should be possible to create the skeleton of a working client using the OpenAPI definition alone.

==== Error situations

See <<http_status_codes>> for general guidance.

[[sc_conformance_classes]]
=== Declaration of conformance classes

==== Operation

To support "generic" clients for accessing servers implementing OGC API - Processes in general - and not "just" a specific API / server, the server must declare the requirements classes it implements and conforms to.

include::../requirements/core/REQ_conformance-op.adoc[]


==== Response

include::../requirements/core/REQ_conformance-success.adoc[]

.Schema for the list of requirements classes
[source,yaml]
----
include::../../openapi/schemas/common-core/confClasses.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/common-core/confClasses.yaml[`confClasses.yaml`].

.Requirements class response document
====
This example response in JSON is for a server that supports OpenAPI 3.0 for
the API definition and HTML and JSON as encodings.

[source,json]
----
include::../examples/json/ConfClasses.json[]
----
====


==== Error situations

See <<http_status_codes>> for general guidance.


=== Use of HTTP 1.1

include::../requirements/core/REQ_http.adoc[]

This include the correct use of status codes, headers. etc.

include::../recommendations/core/REC_http-head.adoc[]

Supporting the method HEAD in addition to GET can be useful for clients and is simple to implement.  In particular, the HEAD method is useful in determining the size of a potential response.

include::../recommendations/core/REC_content-length.adoc[]

Servers implementing https://docs.ogc.org/DRAFTS/17-069r4.html#cross_origin[Cross-Origin Resource Sharing (CORS)] will also implement the OPTIONS method.

[[http_status_codes]]
==== HTTP status codes

<<status_codes>> lists the main HTTP status codes that clients should be
prepared to receive.

This includes, for example, support for specific security schemes or URI
redirection.

In addition, other error situations may occur in the transport layer
outside of the server.

[[status_codes]]
.Typical HTTP status codes
[cols="15,85",options="header"]
|===
|Status code |Description
|`200` |A successful request.
|`201` |The request was successful and one or more new resources have been created.
|`204` |The request was successful but did not generate any content.
|`400` |The server cannot or will not process the request due to an apparent client error. For example, a query parameter had an incorrect value.
|`401` |The request requires user authentication. The response includes a `WWW-Authenticate` header field containing a challenge applicable to the requested resource.
|`403` |The server understood the request but is refusing to fulfill it. While status code `401` indicates missing or bad authentication, status code `403` indicates that authentication is not the issue, but the client is not authorized to perform the requested operation on the resource.
|`404` |The requested resource does not exist on the server. For example, a path parameter had an incorrect value.
|`405` |The request method is not supported. For example, a POST request was submitted, but the resource only supports GET requests.
|`406` |The `Accept` header submitted in the request did not support any of the media types supported by the server for the requested resource.
|`410` |The target resource is no longer available at the origin server.
|`429` |The user has sent too many requests in a given amount of time ("rate limiting").
|`500` |An internal error occurred in the server.
|`501` |The server does not support the functionality required to fulfill the request.
|===

More specific guidance is provided for each resource, where applicable.

include::../recommendations/core/PER_additional-status-codes.adoc[]

When a server encounters an error in the processing of a request, it may wish to include information in addition to the status code in the response. Since Web API interactions are often machine-to-machine, a machine-readable report would be preferred. https://datatracker.ietf.org/doc/html/rfc7807[RFC 7807] addresses this need by providing "Problem Details" response schemas for both JSON and XML.

include::../recommendations/core/REC_problem-details.adoc[]

=== Support for cross-origin requests

Access to content from a HTML page is by default prohibited for security reasons if the content is located on another host than the webpage ("same-origin policy"). Cross-origin resource sharing is a mechanism that allows restricted resources on a web page to be requested from another domain outside the domain from which the first resource was served. A typical example is a web-application accessing processes and data from multiple servers.

include::../recommendations/core/REC_cross-origin.adoc[]

Two common mechanisms to support cross-origin requests are:

* link:https://en.wikipedia.org/wiki/Cross-origin_resource_sharing[Cross-origin resource sharing (CORS)]
* link:https://en.wikipedia.org/wiki/JSONP[JSONP (JSON with padding)]

include::../recommendations/core/REC_access-control-expose-headers.adoc[]

include::../recommendations/core/REC_html.adoc[]


[[sc_limit_parameter]]
=== Limit parameter

Several resources defined in this Standard (see <<sc_process_list,Retrieve a process list>>, <<sc_job_list,Retrieve a job list>>) use the `limit` parameter to control the maximum number of results that are presented in a response page.

* The client can request a limit it is interested in.

* The server likely has a default value for the limit, and a maximum limit.

* If the server has any more results available than it returns (the number it returns is less than or equal to the requested/default/maximum limit) then the server will include a link to the next set of results.

As an example, using the default/maximum values of 10/1000 from the OpenAPI fragment in requirement <<req_core_pl-limit-definition,`/req/core/pl-limit-definition`>> or <<req_job-list_limit-definition,`/req/job-list/limit-definition`>>:

* If the client asks for 10 results, the client will get 0 to 10 (as requested) and if there are more, a `next` link;

* If the client does not specify a limit, the client will get 0 to 10 (default) and if there are more, a `next` link;

* If the client asks for 5000 results, the client might get up to 1000 results (server-limited) and if there are more, a `next` link;

* If the client follows the next link from the previous response, the client might get up to 1000 additional results and if there are more, a `next` link.

This Standard provides requirements and recommendations about links in general and the `next` link in particular at the appropriate resource end points.

[[next-link-discussion]]
This Stadard does not mandate any specific implementation approach for the `next` links.

An implementation of the Processes API could use opaque links that are managed by the server. It is up to the server to determine how long these links can be dereferenced. Clients should be prepared to receive a 404 response.

Another implementation approach is to use an implementation-specific parameter that specifies the index within the result set from which the server begins presenting results in the response, like `offset` or the `startIndex` parameter that was used in <<WFS20,WFS 2.0>>.

An implementation of the Processes API will return no `next` link, if all selected results have been returned, and the server knows for certain that there are no further results to be presented.  However, in some cases, the server may not be aware that it has already returned all selected results. For example, if the request states `limit=10` and the query to the backend returns exactly 10 results.  The server may not know if there are more results or not (in most cases there will be more results), unless the total number of results is also computed, which may be too costly. The server will then prudently add the `next` link, and if there are no more results, dereferencing the next link will return an empty results list and no `next` link. This behavior is consistent with the statements above.

Clients should not assume that paging is safe against changes to the dataset being accesses while a client iterates through `next` links. If a server provides opaque links these could be safe and maintain the state during the original request. Using a parameter for the start index, however, will not be safe.

[[prev-link-discussion]]
This Standard also has recommendations about including a `prev` link at the appropriate resource end points.  Providing `prev` links supports navigating back and forth between pages, but depending on the implementation approach, it may be too complex to implement.


=== Link headers

include::../recommendations/core/REC_link-header.adoc[]

[[sc_process_list]]
=== Retrieve a process list

The following section defines the requirements to retrieve the available processes offered by an implmentation of the Processes API.

It should be noted that the number of processes exposed via the Processes API may be very different than the number of processes offer by a back-end system upon which the Processes API is implemented.

==== Operation

===== Process list

include::../requirements/core/REQ_process-list-op.adoc[]


===== Parameter `limit`

include::../requirements/core/REQ_process-list-limit-def.adoc[]

include::../recommendations/core/PER_process-list-limit-default-minimum-maximum.adoc[]

include::../requirements/core/REQ_process-list-limit-response.adoc[]

include::../recommendations/core/PER_process-list-limit-response.adoc[]


==== Response

include::../requirements/core/REQ_process-list-success.adoc[]

.Schema for the process list
[source,yaml]
----
include::../../openapi/schemas/processes-core/processList.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/processList.yaml[`processList.yaml`].

[[schema-processSummary]]
.Schema for a process summary
[source,yaml]
----
include::../../openapi/schemas/processes-core/processSummary.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/processSummary.yaml[`processSummary.yaml`].

(see also: https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/descriptionType.yaml[`descriptionType.yaml`]).

[[job-control-options-schema]]
.Schema for the job control options
[source,yaml]
----
include::../../openapi/schemas/processes-core/jobControlOptions.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/jobControlOptions.yaml[`jobControlOptions.yaml`].

The number of process summaries returned depends on the server and the parameter `limit.`

See the discussion about the `limit` parameter in the <<sc_limit_parameter,Limit parameter>> section.

include::../requirements/core/REQ_process-list-links.adoc[]

include::../requirements/core/REQ_process-summary-links.adoc[]

See the discussion about the `next` links in the <<next-link-discussion,Limit parameter>> section.

include::../recommendations/core/REC_process-list-next-1.adoc[]

include::../recommendations/core/REC_process-list-next-2.adoc[]

include::../recommendations/core/REC_process-list-next-3.adoc[]

See the discussion about the `prev` link in the  <<prev-link-discussion,Limit parameter>> section.

include::../recommendations/core/PER_process-list-prev.adoc[]

.A HTTP GET request for retrieving the list of offered processes encoded as JSON.
====
[source]
----
GET /processes HTTP/1.1
Host: processing.example.org
----
====

.A Process list encoded as JSON.
====
[source,json]
----
include::../examples/json/ProcessList.json[]
----
====


==== Error situations

See <<http_status_codes>> for general guidance.


[[sc_process_description]]
=== Retrieve a process description

The following section defines the requirements to retrieve metadata about a process.


==== Operation

include::../requirements/core/REQ_process-description-op.adoc[]


==== Response

include::../requirements/core/REQ_process-description-success.adoc[]

The <<rc_core,Core>> does not mandate the use of a specific process description
to specify the interface of a process.  That said, the <<rc_core,Core>>
requirements class makes the following recommendation:

include::../recommendations/core/REC_ogc-process-description.adoc[]


==== Error situations

See <<http_status_codes>> for general guidance.

include::../requirements/core/REQ_process-exception-no-such-process.adoc[]


[[sc_execute_process]]
=== Execute a process

This section describes the requirements for executing a process.

Depending on the description of the <<sc_process_description,process>> and the <<sc_execution_mode,negotiated process execution mode>>, process execution may result in the creation of a <<sc_retrieve_job_results,job resource>>.


==== Operation

include::../requirements/core/REQ_process-execute-op.adoc[]

==== Request body

===== Content schema

include::../requirements/core/REQ_process-execute-request.adoc[]

[[execute-request-body]]
.Schema for execute
[source,yaml]
----
include::../../openapi/schemas/processes-core/execute.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/execute.yaml[`execute.yaml`].

[[inline-or-ref-data]]
.Schema for an in-line or referenced process input value
[source,yaml]
----
include::../../openapi/schemas/processes-core/inlineOrRefData.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/inlineOrRefData.yaml[`inlineOrRefData.yaml`].

(see also: <<input-value-noobject-schema,inputValueNoObject.yaml>>, <<qualified-value-schema,qualifiedInputValue.yaml>>, <<link-schema,link.yaml>>)

[[output-schema]]
.Schema for a process output
[source,yaml]
----
include::../../openapi/schemas/processes-core/output.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/output.yaml[`output.yaml`].

[[format-schema]]
.Schema for a format qualifier
[source,yaml]
----
include::../../openapi/schemas/processes-core/format.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/format.yaml[`format.yaml`].

[[sc_process_inputs]]
===== Process inputs

====== Overview

Each process input is a name/value pair that appears in the `inputs` section of
an execute request as show in the following example:

```
"inputs": {
   "inputName1": <input value 1>,
   "inputName2": <input value 2>,
   etc.
}
```

The actual name of each input is its identifier as specified by the input's definition in the <<sc_process_description,process description>>.

====== Input values 

As shown in https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/inlineOrRefData.yaml[inlineOrRefData.yaml], a process input value that is specified in-line in an execute request can be:

* a simple literal value,
* an array,
* a qualified value,
* a binary value,
* or a bounding box.

[[simple-literals]]
*_Simple literal values:_*

A simple literal value can be a string, number, integer or Boolean.

[[input-value-noobject-schema]]
.Schema for a simple literal value
[source,yaml]
----
include::../../openapi/schemas/processes-core/inputValueNoObject.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/inputValueNoObject.yaml[`inputValueNoObject.yaml`].

(see also: <<binary-input-value-schema,binaryInputValue.yaml>>, <<bbox-schema,bbox.yaml>>)

.Simple literal value examples.
====
A string literal:
[source]
----
"stringInput": "String value"
----

A date string:
[source]
----
"dateInput": "2021-05-24T20:40:13-05:00"
----

A number:
[source]
----
"numberInput": 3.14159
----

An integer:
[source]
----
"integerInput": 10
----

A Boolean:
[source]
----
"booleanInput": true
----
====

[[arrays]]
*_Array of values:_*

Array elements, as per <<inline-or-ref-data,inlineOrRefData.yaml>>, can be:

* <<simple-literals,simple literals>>,
* embedded arrays,
* <<qualified-value,qualified values>>,
* <<binary-value,binary values>>,
* <<bounding-box-value,bounding box values>>,
* or references to values using <<link-schema,links>>.

include::../requirements/core/REQ_process-execute-input-array.adoc[]

.Array value examples.
====
An array of simple values:
[source]
----
"arrayOfSimpleValues": [1, 2, 4, 10, 7]
----

An array with a single simple value:
[source]
----
"arrayOfSimpleValues": ["a"]
----

An array of arrays of simple values:
[source]
----
"arrayOfArrays": [[1,2,3,4], ["a","b","c","d"]]
----

An array of objects values:
[source]
----
"arrayOfQualifiedValues": [
  {
    "value": {
      "measurement": 10.3,
      "uom": "m",
      "reference": "https://ucum.org/ucum-essence.xml"
    }
  },
  {
    "value": {
      "measurement": 10.5,
      "uom": "m",
      "reference": "https://ucum.org/ucum-essence.xml"
    }
  },
  {
    "value": {
      "measurement": 10.9,
      "uom": "m",
      "reference": "https://ucum.org/ucum-essence.xml"
    }
  },...
],
----

NOTE: In an execute request, as per requirement <<req_core_process-execute-input-inline-object,/req/core/process-execute-input-inline-object>>, object values must be encoded as <<qualified-value,qualified values>>.
====

[[qualified-value]]
*_Qualified values:_*

A qualified value is a <<input-value-schema,value>> that can be optionally qualified with a `format` parameter.

Qualified values can be used to encode process input values that, according to their definition in the <<sc_process_description,process description>>, can be of multiple media types.  The `format` parameter is used to identify the specific media type being provided as the process input.

Qualified values can also be used to encode object-valued process inputs in order to avoid ambiguity with the built-in value schemas defined in this standard (i.e. <<bounding-box-value,bbox.yaml>>, <<link-schema,link.yaml>> or <<qualified-value,qualifiedInputValue.yaml>> itself).

The actual _value_ in a qualified value object is specified using the `value` key.  The value of the `value` key is an instance of <<input-value-schema,inputValue.yaml>>.

[[qualified-value-schema]]
.Schema for a qualified value
[source,yaml]
----
include::../../openapi/schemas/processes-core/qualifiedInputValue.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/qualifiedInputValue.yaml[`qualifiedInputValue.yaml`].

(see also: <<format-schema,format.yaml>>)

[[input-value-schema]]
.Schema of a process input value
[source,yaml]
----
include::../../openapi/schemas/processes-core/inputValue.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/inputValue.yaml[`inputValue.yaml`].

(see also: <<input-value-noobject-schema,inputValueNoObject.yaml>>)

include::../requirements/core/REQ_process-execute-input-inline-object.adoc[]

include::../requirements/core/REQ_process-execute-input-inline-multiple-types.adoc[]

.Qualified value examples.
====
An example of a complex process input value.
[source,json]
----
"complexObjectInput": {
  "value": {
    "property1": "value1",
    "property2": "value2",
    "property3": "value3"
  }
}
----

In this second example, the property, `geometryInput` has a cardinality of greater than 1 and value instances can be one of a number of enumerated media types.  The schema of `geometryInput` from the <<ogc_process_description,OGC process description>> for the process might be:

[source,json]
----
"geometryInput": {
  "title": "Geometry input",
  "description": "This is an example of a geometry input.  In this case the geometry can be expressed as a GML or GeoJSON geometry.",
  "minOccurs": 2,
  "maxOccurs": 5,
  "schema": {
    "oneOf": [
      {
        "type": "string",
        "contentMediaType": "application/gml+xml; version=3.2",
        "contentSchema": "http://schemas.opengis.net/gml/3.2.1/geometryBasic2d.xsd"
      },
      {
        "$ref": "http://schemas.opengis.net/ogcapi/features/part1/1.0/openapi/schemas/geometryGeoJSON.json"
      }
    ]
  }
},
----

and an instance of this process input in an execute request might be:

[source]
----

"geometryInputs": [
  {
    "value": "<gml:Polygon gml:id=\"GID1\" srsName=\"urn:ogc:def:crs:OGC::CRS84\"><gml:exterior><gml:LinearRing><gml:posList>-77.024519 38.810529 -77.024635 38.810973 -77.024704 38.810962 -77.024776 38.811239 -77.024957 38.81121 -77.024905 38.811012 -77.024905 38.811012 -77.024865 38.810857 -77.025024 38.810832 -77.025071 38.811012 -77.025203 38.810992 -77.02506 38.810444 -77.024519 38.810529</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>",
    "mediaType": "application/gml+xml; version=3.2"
  },
  {
    "value": {
      "type": "Polygon",
      "coordinates": [[[ -176.5814819, -44.10896301 ],
                       [ -176.5818024, -44.10964584 ],
                       [ -176.5844116, -44.11236572 ],
                       [ -176.5935974, -44.11021805 ],
                       [ -176.5973511, -44.10743332 ],
                       [ -176.5950928, -44.10562134 ],
                       [ -176.5858459, -44.1043396  ],
                       [ -176.5811157, -44.10667801 ],
                       [ -176.5814819, -44.10896301 ]]]
    },
    "mediaType": "application/geo+json"
  }
]
----

In this case, the `mediaType` parameter is used to indicate the specific type of geometry being passed as input in each case: GML Polygon for the first element of the array and GeoJSON Polygon for the second element.
====

[[binary-value]]
*_Binary values:_*

In some cases, for example to pass through firewalls, binary input values need to be encoded in-line in an execute request as a string.

[[binary-input-value-schema]]
.Schema for an in-line binary value
[source,yaml]
----
include::../../openapi/schemas/processes-core/binaryInputValue.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/binaryInputValue.yaml[`binaryInputValue.yaml`].

include::../requirements/core/REQ_process-execute-input-inline-binary.adoc[]

.Binary value examples.
====

Below is an example of an image process input whose media type is defined in the
<<sc_process_description,process description>>.  The schema definition for this process input might be:

[source,json]
----
"schema": {
  "type": "string",
  "contentEncoding": "binary",
  "contentMediaType": "image/tiff; application=geotiff"
}
----

and an example instance value in an execute request might be:

[source,json]
----
"imageInput": "R0lGODdhNAHCAfcAAAcHDD+Gs4sLDQpDaqGFdaHE54dJPEoECUlGRteKgcdITgokG4hoVkpY\ngNzHwKKkqOLm7RRjlEgpHU9iZ44lHQYqVdmki6doVmhHOMOIeJG20HiDjCcKBglIeadISrso\nJGooFNbN2d2qr8aljyklHwQJQkdvkWaKxIdrb442LidLeGhMTp6LkeP1+Kh3aiUuVAoUHmlu\ngkcwNYdZRmkJDYGcsDFokElVYyk1NsWWhLEPDtmQldrUyoyFhrjo+Nna5d+4tMGstspoXgc4\n...qgu7sSu7qbtCs2u7t6u6rLsrp4u7veu76eO6vyu8w0u8xWu8x4u8yau8shu8y+u8zwu90Su9\n00u91Wu914u92au928u9whsQADs="
----

NOTE: Even though the schema indicates that the input type is `binary`, when the input value is encoded in-line in an execute request, as per requirement <<req_core_process-execute-input-inline-binary,/req/core/process-execute-input-inline-binary>>, the binary value is encoded as base64-encoded string.

In this second example, the image input can be one of a number of value types denoted in JSON Schema by the use of the `oneOf[]` construct.  An example schema for this a process input might be:

[source,json]
----
"schema": {
  "oneOf": [
    {
      "type": "string",
      "contentEncoding": "binary",
      "contentMediaType": "image/tiff; application=geotiff"
    },
    {
      "type": "string",
      "contentEncoding": "binary",
      "contentMediaType": "image/jp2"
    }
  ]
}
----

and a JPEG2000 instance example in an execute request might be:

[source,json]
----
{
  "value": "VBORw0KGgoAAAANSUhEUgAABvwAAAa4CAYAAABMB35kAAABhGlDQ1BJQ0MgcHJvZmlsZQAA\nKJF9kT1Iw0AcxV9TpSL1A+xQxCFDdbIgKuKoVShChVArtOpgcumH0KQhSXFxFFwLDn4sVh1c\nnHV1cBUEwQ8QNzcnRRcp8X9JoUWMB8f9eHfvcfcOEOplplkdY4Cm22Y6mRCzuRUx9IogouhH\n ... \nj3Z5mX7/PCPVRJV92rpHK24xcJrzk20+tkeYlCPqcZNO3Lpni1OJWatPCcmgGDEqx7Om6lfa\nppM4k4BTe9+bsn3L9/9/yWhA0PwQGW8ipCZsnZt9lsdrYEM8z/M8z/M8z/M8z/M8z/MzLWY1\nAAAACUlEQVQ871H6P6JI+TxS5Wn2AAAAAElFTkSuQmCC",
  "mediaType": "image/jp2"
}
----
====

[[bounding-box-value]]
*_Bounding box values:_*

A process input value instance can be a bounding box.

include::../requirements/core/REQ_process-execute-input-inline-bbox.adoc[]

[[bbox-schema]]
.Schema for a bounding box value
[source,yaml]
----
include::../../openapi/schemas/processes-core/bbox.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/bbox.yaml[`bbox.yaml`].

This schema is meant to be a template for defining bounding box process inputs. If the specified `default` and `enum` are suitable for the client's requirements then this file can be referenced directly in the process description.

include::../recommendations/core/PER_process-execute-input-inline-bbox.adoc[]

NOTE: The `crs` property is defined using an `anyOf` of either an enumeration or a generic URI string to allow execution requests making use of a CRS other than CRS84 and CRS84h.  These may be supported by the server to validate against the canonical OGC schema.

*_Input validation_*

Process inputs in an execute request and the corresponding process input definition in the <<sc_process_description,process description>> have a validation relationship.  That is to say, the schema of a process input definition from the <<sc_process_description,process description>> can be used to validate the component of the corresponding process input value in an execute request that is an instance of <<input-value-schema,inputValue.yaml>>.

[%unnumbered]
====
Consider a process input named `complexObjectInput` with the following definition from an <<ogc_process_description,OGC process description>>:

[source,json]
----
"complexObjectInput": {
  "title": "Complex Object Input Example",
  "description": "This is an example of a complex object input.",
  "schema": {
    "type": "object",
    "required": [
      "property1",
      "property5"
    ],
    "properties": {
      "property1": {
        "type": "string"
      },
      "property2": {
        "type": "string",
        "format": "uri"
      },
      "property3": {
        "type": "number"
      },
      "property4": {
        "type": "string",
        "format": "date-time"
      },
      "property5": {
        "type": "boolean"
      }
    }
  }
}
----

and the following instance in an execute request:

[source,json]
----
"inputs": [
  .
  .
  .
  "complexObjectInput": {
    "value": {
      "property1": "value1",
      "property2": "value2",
      "property3": "value5"
    }
  },
  .
  .
  .
]
----

The process input value in this execute request is an instance of a <<qualified-value,qualified value>>.

For the purposes of validation, the server needs to only validate the component of the <<qualified-value,qualified value>> that is an instance of <<input-value-schema,inputValue.yaml>> against the `schema` fragment from the <<ogc_process_description,OGC process description>>.  Specifically, the validation target is:

[source,json]
----
{
  "property1": "value1",
  "property2": "value2",
  "property3": "value5"
}
----

NOTE: This example makes use of an <<ogc_process_description,OGC process description>>.  However, any other process description vocabulary may be used and applied, for the purpose of validation, in a similar manner.
====

include::../requirements/core/REQ_process-execute-input-validation.adoc[]

[[sc_execution_mode]]
===== Execution mode

A process may be executed synchronously or asynchronously.

Which mode a server responds with is a function of the job control options specified in the <<sc_process_description,process description>> and the presence or absence of the HTTP `Prefer` header (http://tools.ietf.org/rfc/rfc7240.txt[IETF RFC 7240]).

include::../requirements/core/REQ_process-execute-default-execution-mode.adoc[]

include::../requirements/core/REQ_process-execute-auto-execution-mode.adoc[]

include::../recommendations/core/REC_process-execute-honor-prefer.adoc[]

include::../recommendations/core/REC_process-execute-handle-prefer.adoc[]

include::../recommendations/core/REC_process-execute-preference-applied.adoc[]

[[sc_process_outputs]]
===== Process outputs

*_Overview:_*

Each process output is a named object that appears in the `outputs` section of
an <<execute-request-body,execute request>>. The name of each output is its identifier as specified by the output's definition in the <<sc_process_description,process description>>.

*_Default outputs:_*

include::../requirements/core/REQ_process-execute-default-outputs.adoc[]

*_Output value format:_*

A process output can be defined in the <<sc_process_description,process description>> as being of one or more media types.   In cases where a specific output can be presented in one of a number of media types, the `format` parameter in the <<output-schema,execute request>> can be used to indicate the format that should be used to present the process output value in the server's <<sc_execute_response,response>>.

[[sc_output_value_size]]
*_Output value size:_*

Since a priori knowledge of the size of any given output is generally not known, hints can be provided to the server to prevent the inadvertent transmission of large volumes of output.

Return preferences signal to a server how output values should be transmitted based on the size of the output and any accompanying https://datatracker.ietf.org/doc/html/rfc7240#section-4.2[`return` preferences] as define defined in http://tools.ietf.org/rfc/rfc7240.txt[IETF RFC 7240].

include::../recommendations/core/REC_process-execute-honor-return-preference.adoc[]

include::../recommendations/core/REC_process-execute-handle-return-preference.adoc[]

==== Example

.An execute request.
====
[source,json]
----
include::../examples/json/Execute.json[]
----
====

[[sc_execute_response]]
==== Response

===== Overview 

The way a server responds to a process execution request is determined by the following parameters:

* The <<sc_execution_mode,negotiated execution mode>> (synchronous or asynchronous),
* The number of outputs requested,
* The negotiated content type for the response (via the https://www.rfc-editor.org/rfc/rfc2616#section-14.1[HTTP Accept] header),
* Any negotiated client preferences (via the HTTP Prefer header).

The following table maps the possible responses based on the combinations of these execute parameters.  The column headers denote:

. *Negotiated execute mode*: see <<sc_execution_mode>>
. *Requested # outputs*: The number of output requested in the <<execute-request-body,execute request>>
. *Return preference*: The negotiated <<sc_output_value_size,return preferences>>
. *Response HTTP code*: The https://datatracker.ietf.org/doc/html/rfc2616#section-6.1.1[HTTP status code] that the server should generate in this context.
. *Response headers*: Any required https://datatracker.ietf.org/doc/html/rfc2616#section-14[HTTP headers] that the server must include in this context.
. *Response media type*: The value of the HTTP `Content-Type` header that the server should generate in this context.
. *Response body*: A description of the content of the response body in this context.
. *Req./Rec./Perm.*: The corresponding requirements/recommendations/permission as per this Standard.

[[table_core_execute_responses]]
.Execute responses based on number of requested outputs, request HTTP headers and the size of output values.
[cols=8,options="header"]
|===
|Negotiated execute mode
|Requested # outputs
|Return preference (`Prefer` header)
|Response HTTP code
|Response headers
|Response media type (`Content-Type` header)
|Response body
|Req./Rec./Perm.

.5+|sync
|1
|_n/a_
|200
|
|_as negotiated_
|requested process output
|See requirement: <<req_core_process-execute-sync-one,/req/core/process-execute-sync-one>>
1.3+|N
|_none_
.3+|200
.3+|
.3+|application/json^7^
.3+|<<schema_results,results.yaml>>
|See <<sync_note_3,Note 3.>>,<<sync_note_4,Note 4>>

|minimal
|See <<sync_note_3,Note 3.>>,<<sync_note_5,Note 5>>

|representation
|See <<sync_note_3,Note 3.>>,<<sync_note_6,Note 6>>

|_none_
|_n/a_
|204
|
|_n/a_
|_empty_
|See requirement: <<req_core_job-results-param-outputs-empty,/req/core/job-results-param-outputs-empty>>

|async
|_n/a_
|_n/a_
|201
|_Location_ to newly created job
|application/json
|<<schema-statusInfo,statusInfo.yaml>>
|See requirement: <<req_core_process-execute-success-async,/req/core/process-execute-success-async>>
|===

[NOTE]
====
* The value *_n/a_* in a cell means that the corresponding parameter is not applicable, not specified, not required or can be ignored in this context.
* The value *_as negotiated_* means that the output content type is as negotiated between the client and the server based on the value of the https://www.rfc-editor.org/rfc/rfc2616#section-14.1[HTTP Accept] header.
====

[NOTE]
====
This above table shows all possible combinations of execute parameters that are specified by this Standard.  Not all these combinations need to be implemented by a server conforming to this Standard.  For example, a server that only offers processes that can be executed synchronously does not need to implement any of the asynchronous requirements.
====

[[sync_note_3]]
[NOTE]
====
* See requirement: <<req_core_process-execute-sync-many-json,/req/core/process-execute-sync-many-json>>.
* See permission: <<per_core_process-execute-sync-many-other-formats,/per/core/process-execute-sync-many-other-formats>>.
====

[[sync_note_4]]
[NOTE]
====
* See recommendation: <<rec_core_process-execute-sync-many-json-prefer-none,/rec/core/process-execute-sync-many-json-prefer-none>>.
====

[[sync_note_5]]
[NOTE]
====
* See recommendation: <<rec_core_process-execute-sync-many-json-prefer-minimal,/rec/core/process-execute-sync-many-json-prefer-minimal>>.
====

[[sync_note_6]]
[NOTE]
====
* See recommendation: <<rec_core_process-execute-sync-many-json-prefer-representation,/rec/core/process-execute-sync-many-json-prefer-representation>>.
====

[[sync_note_7]]
[NOTE]
====
* See recommendation: <<per_core_process-execute-multiple-output-pkg,/per/core/process-execute-multiple-output-pkg>>.
====

[[schema_results]]
.Schema for processing results presented as a JSON document
[source,yaml]
----
include::../../openapi/schemas/processes-core/results.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/results.yaml[`results.yaml`].

The https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/results.yaml[`results.yaml`] schema defines a map using the respective output identifier as the key. The value of an output can be returned as an in-line value or by reference.

===== Response requesting a single processing output

When a process is executed synchronously and a single processing output is requested, the following requirements and recommendations apply:

include::../requirements/core/REQ_process-execute-success-sync-one.adoc[]

include::../requirements/core/REQ_process-execute-success-sync-one-default-content.adoc[]

NOTE: The size of a response may be determined without actually transmitting the entire response by using the <<rec_core_http-head,HTTP HEAD>> method to retrieve the <<rec_core_content-length,`Content-Length`>> header.

===== Response requesting multiple processing outputs

When a process is executed synchronously and multiple processing outputs are requested, the following requirements and recommendations apply:

include::../requirements/core/REQ_process-execute-success-sync-many-json.adoc[]

include::../recommendations/core/PER_process-execute-multiple-output-pkg.adoc[]

include::../recommendations/core/REC_process-execute-success-sync-many-json-prefer-none.adoc[]

include::../recommendations/core/REC_process-execute-success-sync-many-json-prefer-minimal.adoc[]

include::../recommendations/core/REC_process-execute-success-sync-many-json-prefer-representation.adoc[]

include::../recommendations/core/PER_process-execute-success-sync-many-other-formats.adoc[]

===== Job creation on synchronous process execution

This Standard does not mandate that servers create a job as a result of executing a process synchronously.  However, the following permission is given:

include::../recommendations/core/PER_process-execute-sync-job.adoc[]

For servers that implement this permission and do create a job as a result of synchronous execution of a process, the following requirement applies:

include::../requirements/core/REQ_job-results-success-sync.adoc[]

The job reference in the header can then be used to <<req_core_process-execute-success-async,re-fetch the results>> of the original synchronous execution.

===== Response for asynchronous processes execution

In the case of asynchronous execution, the following requirement applies:

include::../requirements/core/REQ_process-execute-success-async.adoc[]

==== Error situations

See <<http_status_codes>> for general guidance.

If the process with the specified identifier does not exist on the server, see requirement <<req_core_process-exception-no-such-process,/req/core/process-exception/no-such-process>>.


[[sc_retrieve_status_info]]
=== Retrieve status information about a job

The following section describes the requirements to retrieve information about the status of a job.


==== Operation

include::../requirements/core/REQ_job-op.adoc[]

==== Response

include::../requirements/core/REQ_job-success.adoc[]

[[schema-statusInfo]]
.Schema for status info
[source,yaml]
----
include::../../openapi/schemas/processes-core/statusInfo.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/statusInfo.yaml[`statusInfo.yaml`].

.Schema for status codes
[source,yaml]
----
include::../../openapi/schemas/processes-core/statusCode.yaml[]
----

NOTE: This schema can also be obtained from https://raw.githubusercontent.com/opengeospatial/ogcapi-processes/master/openapi/schemas/processes-core/statusCode.yaml[`statusCode.yaml`].

The job status information includes several optional date-time fields that represent milestones in the life cycle of a job.   The following are recommended for servers that decide to populate some or all these date-time fields:

include::../recommendations/core/REC_job-status.adoc[]

include::../recommendations/core/REC_job-links.adoc[]

NOTE: Once a job has finished execution and is no longer consuming compute resources, the duration of processing can be computed as `finished-started`.  The `updated` field, however, may still be revised as the system continues processing outputs, storing results, releasing compute resources, etc.

.A HTTP GET request for retrieving status information about a job encoded as JSON.
====
[source]
----
GET /jobs/81574318-1eb1-4d7c-af61-4b3fbcf33c4f HTTP/1.1
Host: processing.example.org
----
====

.A job encoded as JSON.
====
[source,json]
----
include::../examples/json/StatusInfo.json[]
----
====


==== Error situations

See <<http_status_codes>> for general guidance.

If the process with the specified identifier does not exist on the server, see requirement <<req_core_process-exception-no-such-process,/req/core/process-exception/no-such-process>>.

include::../requirements/core/REQ_job-exception-no-such-job.adoc[]


[[sc_retrieve_job_results]]
=== Retrieve job results

A process can generate zero or more outputs.  This clause specifies how:

* Processing results can be retrieved individually in a single request,
* A subset of processing results can be retrieved in a single request,
* All processing results can be retrieved in a single request.

[[sc_retrieve_job_results_one]]
==== Retrieving results individually

===== Operation

include::../requirements/core/REQ_job-result-op.adoc[]

NOTE: The size of a processing result may be determined without actually transmitting the entire result by using the <<rec_core_http-head,HTTP HEAD>> method to retrieve the <<rec_core_content-length,`Content-Length`>> header.

[[sc_retrieve_job_results_many]]
==== Retrieving multiple results

===== Operation

include::../requirements/core/REQ_job-results-op.adoc[]

===== Parameters

include::../requirements/core/REQ_job-results-param-outputs.adoc[]

include::../requirements/core/REQ_job-results-param-outputs-response.adoc[]

include::../requirements/core/REQ_job-results-param-outputs-omit.adoc[]

include::../requirements/core/REQ_job-results-param-outputs-empty.adoc[]

===== Overview

The way a server responds when retrieving job results depends on:

* The number of outputs requested,
* The negotiated content type for the response (via the https://www.rfc-editor.org/rfc/rfc2616#section-14.1[HTTP Accept] header) or lack thereof,
* Any negotiated client preferences (via the HTTP Prefer header).

The following table maps the possible responses based on the combinations of these execute parameters.

The column headers in the following table denote:

. *Requested # outputs*: The number of outputs requested in the <<execute-request-body,execute request>>.
. *Access path*: The API endpoint from which the result(s) can be retrieved.
. *Return preference*: The negotiated <<sc_output_value_size,return preferences>>.
. *Response HTTP code*: The https://datatracker.ietf.org/doc/html/rfc2616#section-6.1.1[HTTP status code] that the server should generate in this context.
. *Response media type*: The value of the HTTP `Content-Type` header that the server should generate in this context.
. *Response body*: A description of the content of the response body in this context.
. *Req./Rec./Perm.*: The corresponding requirements/recommendations/permission as per this Standard.

[[table_core_getresults_responses]]
.Table mapping `get` results responses based on the input parameter values used on the original execute request.
[cols=7,options="header"]
|===
|Requested # outputs
|Access path
|Return preference (`Prefer` header)
|Response HTTP code
|Response media type (`Content-Type` header)
|Response body
|Req./Rec./Perm.

|1
|/jobs/{jobID}/results/{outputID}
|_n/a_
|200
|_as negotiated_
|requested process output value
|See requirement: <<req_core_job-results-async-one,/req/core/job-results-async-one>>

1.3+|N
.3+|/jobs/{jobID}/results
|_none_
.3+|200
.3+|application/json
.3+|<<schema_results,results.yaml>>
|See <<async_note_2,Note 2>>,<<async_note_3,Note 3>>

|minimal
|See <<async_note_2,Note 2>>,<<async_note_3,Note 4>>

|representation
|See <<async_note_2,Note 2>>,<<async_note_3,Note 5>>

|none
|_n/a_
|_n/a_
|204
|_n/a_
|_n/a_
|See requirement: <<req_core_job-results-param-outputs-empty,/req/core/job-results-param-outputs-empty>>
|===

[NOTE]
====
* The value *_n/a_* in a cell means value of the corresponding parameter is not applicable, not specified, not required or can be ignored in this context.
* The value *_as negotiated_* means that the output content type is as negotiated between the client and the server based on the value of the https://www.rfc-editor.org/rfc/rfc2616#section-14.1[HTTP Accept] header.
====

[[async_note_2]]
[NOTE]
====
* See requirement: <<req_core_job-results-async-many,/req/core/job-results-async-many>>
* See permission: <<per_core_job-results-async-many-other-formats,/per/core/job-results-async-many-other-formats>>
====

[[async_note_3]]
[NOTE]
====
* See recommendation: <<rec_core_job-results-async-many-json-prefer-none,/rec/core/job-results-async-many-json-prefer-none>>
====

[[async_note_4]]
[NOTE]
====
* See recommendation: <<rec_core_job-results-async-many-json-prefer-minimal,/rec/core/job-results-async-many-json-prefer-minimal>>
====

[[async_note_5]]
[NOTE]
====
* See recommendation: <<rec_core_job-results-async-many-json-prefer-representation,/rec/core/job-results-async-many-json-prefer-representation>>
====

The following requirements apply when retrieving the results of a job that was created by executing a process asynchronously OR was created by executing a process synchronously on a server that creates a job even for synchronous execution:

===== Retrieving results individually

include::../requirements/core/REQ_job-results-success-async-one.adoc[]

===== Retrieving multiple results

include::../requirements/core/REQ_job-results-success-async-many.adoc[]


include::../recommendations/core/REC_job-results-success-async-many-json-prefer-none.adoc[]

include::../recommendations/core/REC_job-results-success-async-many-json-prefer-minimal.adoc[]

include::../recommendations/core/REC_job-results-success-async-many-json-prefer-representation.adoc[]

include::../recommendations/core/PER_job-results-success-async-many-other-formats.adoc[]

.A HTTP GET request for retrieving the result a job encoded as JSON.
====
[source]
----
GET /jobs/81574318-1eb1-4d7c-af61-4b3fbcf33c4f/results HTTP/1.1
Host: processing.example.org
----
====

.A result encoded as JSON.
====
[source,json]
----
include::../examples/json/Result.json[]
----
====


==== Error situations

See <<http_status_codes>> for general guidance.

include::../requirements/core/REQ_job-results-exception-no-such-job.adoc[]

include::../requirements/core/REQ_job-results-exception-results-not-ready.adoc[]

include::../requirements/core/REQ_job-results-failed.adoc[]
